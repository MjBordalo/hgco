# author: Miguel Bordalo
#
# This document describes all the PV comming from Arduino sensors and actuators
#

#################################################
#		AO - Analog Output
#################################################

record(ao, $(user):Apperture) {
  info(autosaveFields, "VAL OMSL")
    field(DESC, "Servo motor set variable")
    	field(DTYP, "stream")
    	field(OUT, "@arduino.proto setServo() $(PORT)")
	field(PINI,	"YES")
    	field(DRVL, "0")
    	field(DRVH, "4") #window angle
	field(LOPR, "-5")
	field(HOPR, "180")	#High Operating Range
	field(ADEL, "0.1")
	field(EGU, "window angle")
	field(SCAN, "2 second")
  field(PREC, "1")

    #linear calibration
  	#in this case because this PV is read from a float we cannot use the field LINR
  	#once the .RVAL field is empty
  	field(ASLO, "0.036")	#linear slope calibration
  	#field(AOFF, "-1.215")	#linear slope offset

		#Set PID link
		field(DOL, "$(user):aSubExample.VALA")
		field(OMSL,"closed_loop")

		# When PID is INVALID, go back to 1
		field(IVOA, "Set output to IVOV")
		field(IVOV, "1")
}

record(ao, $(user):Fan) {
  info(autosaveFields, "VAL OMSL")
    	field(DESC, "2Wire Fan")
    	field(DTYP, "stream")
    	field(OUT, "@arduino.proto setFan() $(PORT)")
    	field(DRVL, "0")
    	field(DRVH, "100")
	field(LOPR, "0")
	field(HOPR, "100")	#High Operating Range
	field(ADEL, "1")
	field(EGU, "dutycycle")
	field(SCAN, "2 second")
	field(PINI, "YES")


  field(ASLO, "0.392156")	#linear slope calibration m=100/255

	#Set PID link
	field(DOL, "$(user):aSubExample.VALB")
	field(OMSL,"closed_loop")
}


record(bo, $(user):LEDLight) {
	field(DESC, "Bo for RELE1")
	field(DTYP, "stream")
	field(OUT, "@arduino.proto setRELE1() $(PORT)")
	field(PINI, "YES")
	field(ONAM,	"ON")
	field(ZNAM,	"OFF")
}
record(bo, $(user):MixMaker) {
  info(autosaveFields, "VAL OMSL")
	field(DESC, "Bo for RELE2")
	field(DTYP, "stream")
	field(OUT, "@arduino.proto setRELE2() $(PORT)")
	field(PINI, "YES")
	field(ONAM,	"ON")
	field(ZNAM,	"OFF")

  #Set Control link
    field(DOL, "$(user):ControlMistMaker")
  #field(DOL, "$(user):aSubExample.VALF")# TODO: mudar isto
  field(OMSL,"closed_loop")

}
record(bo, $(user):MixMakerFan) {
  info(autosaveFields, "VAL OMSL")
	field(DESC, "Bo for RELE3")
	field(DTYP, "stream")
	field(OUT, "@arduino.proto setRELE3() $(PORT)")
	field(PINI, "YES")
	field(ONAM,	"ON")
	field(ZNAM,	"OFF")

  #Set Control link
  field(DOL, "$(user):ControlMistMaker")
  #field(DOL, "$(user):aSubExample.VALF") # TODO: mudar isto
  field(OMSL,"closed_loop")

}
# Water Pump 1
record(bo, $(user):WaterPump1) {
	field(DESC, "Bo for RELE4")
	field(DTYP, "stream")
	field(OUT, "@arduino.proto setRELE4() $(PORT)")
	field(PINI, "YES")
	field(ONAM,	"OFF")
	field(ZNAM,	"ON")
	field(OSV,	"MAJOR") #one severity
}
