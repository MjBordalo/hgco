# author: Miguel Bordalo
#
# This document presents the PV in order to control the greenhouse Temperature
#


#################################################
#		Calc - Variables based on calculations
#################################################
# Integral Feedback signal
# I=I+Ts*K*TempError
record(calc, "$(user):ControlMistMaker")
{
		field(DESC, "active Mist Maker")
		#field(SCAN, "10 second")
		field(PINI,	"YES")
		field(VAL,	"0")

		#field(LOPR, "0")			#<--- Isto faz alguma coisa aqui?
		#field(HOPR, "170")
		field(INPA, "$(user):Hum1")
		field(INPB, "60")
		field(INPC, "70")
		field(INPD, "0")
		field(INPE, "1")
		field(INPF, "$(user):MixMaker")
		field(INPG,	"2")
		field(CALC, "A>C?D:(A<(B+G))?E:F")

		field(FLNK,	"$(user):ControlMistMakerfanout")
}
record(fanout, "$(user):ControlMistMakerfanout") {
  #field(SCAN, ".1 second")
  field(LNK1, "$(user):MixMakerFan")
  field(LNK2, "$(user):MixMaker")
}


record(calcout, "$(user):HumInPredictor") {
	#scaned at Ts by TsFanout
	field(DESC,	"HumIn predictor")
	field(OOPT,	"Every Time")	#write output every time record is processed.

	field(INPA,	"$(user):Hum1")
	field(INPB,	"$(user):Hum2")
	field(INPC,	"$(user):Apperture")
	field(INPD,	"$(user):Fan")
	field(INPE,	"$(user):MixMaker")
	field(INPF,	"$(user):Temp1")

	field(INPK,	"$(user):HumInPredictor")
	#INPL -> sample delayed

	field(CALC,	"L:=K ; 0.8006*A +0.3435*B -1.1024*C -0.0032*D +5.3790*E -0.0630*F")
	field(FLNK,	"$(user):HumInPredictorError")
}

###################################
# Error
###################################
record(calc,	"$(user):HumInPredictorError") {
	field(DESC,	"HumInPredictorError")

	field(INPA,	"$(user):HumInPredictor.L") #HumIn predictor delayed
	field(INPB,	"$(user):Hum1")
	field(CALC,	"SQRT((A-B)*(A-B))")
}
